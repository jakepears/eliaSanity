import{a as P}from"./chunk-5DGBPHJE.js";import{a as D}from"./chunk-MIG3QIIX.js";import{a as _}from"./chunk-5OBTBB5P.js";import{a as N}from"./chunk-SXQALA5M.js";import{a as L}from"./chunk-5GIYJXT4.js";import{a as H}from"./chunk-ADM5POMS.js";import{a as C}from"./chunk-F7PWK3E4.js";import{b as I,d as G,g as l,i as v}from"./chunk-2UCHFSGT.js";var T=I((V,o)=>{l();v();var n=L(),F=N(),E=P(),J=D(),M=C(),W=H(),z=_(),A=["RS256","RS384","RS512","ES256","ES384","ES512"],k=["RS256","RS384","RS512"],O=["HS256","HS384","HS512"];W&&(A.splice(3,0,"PS256","PS384","PS512"),k.splice(3,0,"PS256","PS384","PS512"));o.exports=function(f,w,e,d){typeof e=="function"&&!d&&(d=e,e={}),e||(e={}),e=Object.assign({},e);var r;if(d?r=d:r=function(t,a){if(t)throw t;return a},e.clockTimestamp&&typeof e.clockTimestamp!="number")return r(new n("clockTimestamp must be a number"));if(e.nonce!==void 0&&(typeof e.nonce!="string"||e.nonce.trim()===""))return r(new n("nonce must be a non-empty string"));var m=e.clockTimestamp||Math.floor(Date.now()/1e3);if(!f)return r(new n("jwt must be provided"));if(typeof f!="string")return r(new n("jwt must be a string"));var y=f.split(".");if(y.length!==3)return r(new n("jwt malformed"));var u;try{u=J(f,{complete:!0})}catch(t){return r(t)}if(!u)return r(new n("invalid token"));var h=u.header,s;if(typeof w=="function"){if(!d)return r(new n("verify must be called asynchronous if secret or public key is provided as a callback"));s=w}else s=function(t,a){return a(null,w)};return s(h,function(t,a){if(t)return r(new n("error in secret or public key callback: "+t.message));var g=y[2].trim()!=="";if(!g&&a)return r(new n("jwt signature is required"));if(g&&!a)return r(new n("secret or public key must be provided"));if(!g&&!e.algorithms&&(e.algorithms=["none"]),e.algorithms||(e.algorithms=~a.toString().indexOf("BEGIN CERTIFICATE")||~a.toString().indexOf("BEGIN PUBLIC KEY")?A:~a.toString().indexOf("BEGIN RSA PUBLIC KEY")?k:O),!~e.algorithms.indexOf(u.header.alg))return r(new n("invalid algorithm"));var b;try{b=z.verify(f,u.header.alg,a)}catch(c){return r(c)}if(!b)return r(new n("invalid signature"));var i=u.payload;if(typeof i.nbf!="undefined"&&!e.ignoreNotBefore){if(typeof i.nbf!="number")return r(new n("invalid nbf value"));if(i.nbf>m+(e.clockTolerance||0))return r(new F("jwt not active",new Date(i.nbf*1e3)))}if(typeof i.exp!="undefined"&&!e.ignoreExpiration){if(typeof i.exp!="number")return r(new n("invalid exp value"));if(m>=i.exp+(e.clockTolerance||0))return r(new E("jwt expired",new Date(i.exp*1e3)))}if(e.audience){var j=Array.isArray(e.audience)?e.audience:[e.audience],R=Array.isArray(i.aud)?i.aud:[i.aud],q=R.some(function(c){return j.some(function(x){return x instanceof RegExp?x.test(c):x===c})});if(!q)return r(new n("jwt audience invalid. expected: "+j.join(" or ")))}if(e.issuer){var B=typeof e.issuer=="string"&&i.iss!==e.issuer||Array.isArray(e.issuer)&&e.issuer.indexOf(i.iss)===-1;if(B)return r(new n("jwt issuer invalid. expected: "+e.issuer))}if(e.subject&&i.sub!==e.subject)return r(new n("jwt subject invalid. expected: "+e.subject));if(e.jwtid&&i.jti!==e.jwtid)return r(new n("jwt jwtid invalid. expected: "+e.jwtid));if(e.nonce&&i.nonce!==e.nonce)return r(new n("jwt nonce invalid. expected: "+e.nonce));if(e.maxAge){if(typeof i.iat!="number")return r(new n("iat required when maxAge is specified"));var S=M(e.maxAge,i.iat);if(typeof S=="undefined")return r(new n('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(m>=S+(e.clockTolerance||0))return r(new E("maxAge exceeded",new Date(S*1e3)))}if(e.complete===!0){var p=u.signature;return r(null,{header:h,payload:i,signature:p})}return r(null,i)})}});l();v();var Q=G(T(),1);export{Q as a};
//# sourceMappingURL=chunk-PD7PMUKL.js.map
